{
  "BIP": "86",
  "Layer": "Applications",
  "Title": "Key Derivation for Single Key P2TR Outputs",
  "Author": "Andrew Chow <andrew@achow101.com>",
  "Comments-Summary": "No comments yet.",
  "Comments-URI": "https://github.com/bitcoin/bips/wiki/Comments:BIP-0086",
  "Status": "Draft",
  "Type": "Standards Track",
  "Created": "2021-06-22",
  "License": "BSD-2-Clause",
  "sections": [
    {
      "header": "Abstract",
      "content": "This document suggests a derivation scheme for HD wallets whose keys are\ninvolved in single key P2TR ([BIP 341](bip-0341.mediawiki \"wikilink\"))\noutputs as the Taproot internal key."
    },
    {
      "header": "Copyright",
      "content": "This BIP is licensed under the 2-clause BSD license."
    },
    {
      "header": "Motivation",
      "content": "With the usage of single key P2TR transactions, it is useful to have a\ncommon derivation scheme so that HD wallets that only have a backup of\nthe HD seed can be likely to recover single key Taproot outputs.\nAlthough there are now solutions which obviate the need for fixed\nderivation paths for specific script types, many software wallets and\nhardware signers still use seed backups which lack derivation path and\nscript information. Thus we largely use the same approach used in BIPs\n[49](bip-0049.mediawiki \"wikilink\") and\n[84](bip-0084.mediawiki \"wikilink\") for ease of implementation."
    },
    {
      "header": "Specifications",
      "content": "This BIP defines the two needed steps to derive multiple deterministic\naddresses based on a [BIP 32](bip-0032.mediawiki \"wikilink\") master\nprivate key."
    },
    {
      "header": "Public key derivation {#public_key_derivation}",
      "content": "To derive a public key from the root account, this BIP uses the same\naccount-structure as defined in BIPs\n[44](bip-0044.mediawiki \"wikilink\"),\n[49](bip-0049.mediawiki \"wikilink\"), and\n[84](bip-0084.mediawiki \"wikilink\"), but with a different purpose value\nfor the script type.\n\nm / purpose' / coin_type' / account' / change / address_index\n\nFor the `purpose`-path level it uses `86'`. The rest of the levels are\nused as defined in BIPs 44, 49, and 84.\n\nA key derived with this derivation path pattern will be referred to as\n`derived_key` further in this document."
    },
    {
      "header": "Address derivation {#address_derivation}",
      "content": "[BIP 341](bip-0341.mediawiki#cite_ref-22-0 \"wikilink\") states: \\\"If the\nspending conditions do not require a script path, the output key should\ncommit to an unspendable script path instead of having no script path.\nThis can be achieved by computing the output key point as *Q = P +\nint(hash~TapTweak~(bytes(P)))G*.\\\" Thus:\n\ninternal_key:       lift_x(derived_key)\n32_byte_output_key: internal_key + int(HashTapTweak(bytes(internal_key)))G\n\nIn a transaction, the scripts and witnesses are as defined in [BIP\n341](bip-0341.mediawiki#specification \"wikilink\"):\n\nwitness:      <signature>\nscriptSig:    (empty)\nscriptPubKey: 1 <32_byte_output_key>\n(0x5120{32_byte_output_key})"
    },
    {
      "header": "Backwards Compatibility {#backwards_compatibility}",
      "content": "This BIP is not backwards compatible by design. An incompatible wallet\nwill not discover these accounts at all and the user will notice that\nsomething is wrong.\n\nHowever this BIP uses the same method used in BIPs 44, 49, and 84, so it\nshould not be difficult to implement."
    },
    {
      "header": "Test vectors {#test_vectors}",
      "content": "mnemonic = abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about\nrootpriv = xprv9s21ZrQH143K3GJpoapnV8SFfukcVBSfeCficPSGfubmSFDxo1kuHnLisriDvSnRRuL2Qrg5ggqHKNVpxR86QEC8w35uxmGoggxtQTPvfUu\nrootpub  = xpub661MyMwAqRbcFkPHucMnrGNzDwb6teAX1RbKQmqtEF8kK3Z7LZ59qafCjB9eCRLiTVG3uxBxgKvRgbubRhqSKXnGGb1aoaqLrpMBDrVxga8\n\n// Account 0, root = m/86'/0'/0'\nxprv = xprv9xgqHN7yz9MwCkxsBPN5qetuNdQSUttZNKw1dcYTV4mkaAFiBVGQziHs3NRSWMkCzvgjEe3n9xV8oYywvM8at9yRqyaZVz6TYYhX98VjsUk\nxpub = xpub6BgBgsespWvERF3LHQu6CnqdvfEvtMcQjYrcRzx53QJjSxarj2afYWcLteoGVky7D3UKDP9QyrLprQ3VCECoY49yfdDEHGCtMMj92pReUsQ\n\n// Account 0, first receiving address = m/86'/0'/0'/0/0\nxprv         = xprvA449goEeU9okwCzzZaxiy475EQGQzBkc65su82nXEvcwzfSskb2hAt2WymrjyRL6kpbVTGL3cKtp9herYXSjjQ1j4stsXXiRF7kXkCacK3T\nxpub         = xpub6H3W6JmYJXN49h5TfcVjLC3onS6uPeUTTJoVvRC8oG9vsTn2J8LwigLzq5tHbrwAzH9DGo6ThGUdWsqce8dGfwHVBxSbixjDADGGdzF7t2B\ninternal_key = cc8a4bc64d897bddc5fbc2f670f7a8ba0b386779106cf1223c6fc5d7cd6fc115\noutput_key   = a60869f0dbcf1dc659c9cecbaf8050135ea9e8cdc487053f1dc6880949dc684c\nscriptPubKey = 5120a60869f0dbcf1dc659c9cecbaf8050135ea9e8cdc487053f1dc6880949dc684c\naddress      = bc1p5cyxnuxmeuwuvkwfem96lqzszd02n6xdcjrs20cac6yqjjwudpxqkedrcr\n\n// Account 0, second receiving address = m/86'/0'/0'/0/1\nxprv         = xprvA449goEeU9okyiF1LmKiDaTgeXvmh87DVyRd35VPbsSop8n8uALpbtrUhUXByPFKK7C2yuqrB1FrhiDkEMC4RGmA5KTwsE1aB5jRu9zHsuQ\nxpub         = xpub6H3W6JmYJXN4CCKUSnriaiQRCZmG6aq4sCMDqTu1ACyngw7HShf59hAxYjXgKDuuHThVEUzdHrc3aXCr9kfvQvZPit5dnD3K9xVRBzjK3rX\ninternal_key = 83dfe85a3151d2517290da461fe2815591ef69f2b18a2ce63f01697a8b313145\noutput_key   = a82f29944d65b86ae6b5e5cc75e294ead6c59391a1edc5e016e3498c67fc7bbb\nscriptPubKey = 5120a82f29944d65b86ae6b5e5cc75e294ead6c59391a1edc5e016e3498c67fc7bbb\naddress      = bc1p4qhjn9zdvkux4e44uhx8tc55attvtyu358kutcqkudyccelu0was9fqzwh\n\n// Account 0, first change address = m/86'/0'/0'/1/0\nxprv         = xprvA3Ln3Gt3aphvUgzgEDT8vE2cYqb4PjFfpmbiFKphxLg1FjXQpkAk5M1ZKDY15bmCAHA35jTiawbFuwGtbDZogKF1WfjwxML4gK7WfYW5JRP\nxpub         = xpub6GL8SnQwRCGDhB59LEz9HMyM6sRYoByXBzXK3iEKWgCz8XrZNHUzd9L3AUBELW5NzA7dEFvMas1F84TuPH3xqdUA5tumaGWFgihJzWytXe3\ninternal_key = 399f1b2f4393f29a18c937859c5dd8a77350103157eb880f02e8c08214277cef\noutput_key   = 882d74e5d0572d5a816cef0041a96b6c1de832f6f9676d9605c44d5e9a97d3dc\nscriptPubKey = 5120882d74e5d0572d5a816cef0041a96b6c1de832f6f9676d9605c44d5e9a97d3dc\naddress      = bc1p3qkhfews2uk44qtvauqyr2ttdsw7svhkl9nkm9s9c3x4ax5h60wqwruhk7"
    },
    {
      "header": "Reference",
      "content": "-   [BIP32 - Hierarchical Deterministic\nWallets](bip-0032.mediawiki \"wikilink\")\n-   [BIP43 - Purpose Field for Deterministic\nWallets](bip-0043.mediawiki \"wikilink\")\n-   [BIP44 - Multi-Account Hierarchy for Deterministic\nWallets](bip-0044.mediawiki \"wikilink\")\n-   [BIP49 - Derivation scheme for P2WPKH-nested-in-P2SH based\naccounts](bip-0049.mediawiki \"wikilink\")\n-   [BIP84 - Derivation scheme for P2WPKH based\naccounts](bip-0084.mediawiki \"wikilink\")\n-   [BIP341 - Taproot: SegWit version 1 spending\nrules](bip-0341.mediawiki \"wikilink\")"
    }
  ]
}