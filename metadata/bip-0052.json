{
  "BIP": "52",
  "Layer": "Consensus (hard fork)",
  "Title": "Durable, Low Energy Bitcoin PoW",
  "Author": "Michael Dubrovsky <mike+bip@powx.org>",
  "Comments-Summary": "No comments yet.",
  "Comments-URI": "https://github.com/bitcoin/bips/wiki/Comments:BIP-0052",
  "Status": "Draft",
  "Type": "Standards Track",
  "Created": "2021-05-13",
  "License": "BSD-2-Clause",
  "sections": [
    {
      "header": "Simple Summary {#simple_summary}",
      "content": "Bitcoin\\'s energy consumption is growing with its value (see Figure\nbelow). Although scaling PoW is necessary to maintain the security of\nthe network, reliance on massive energy consumption has scaling\ndrawbacks and leads to mining centralization. A major consequence of the\ncentral role of local electricity cost in mining is that today, most\nexisting and potential participants in the Bitcoin network cannot\nprofitably mine Bitcoin even if they have the capital to invest in\nmining hardware. From a practical perspective, Bitcoin adoption by\ncompanies like Tesla (which recently rescinded its acceptance of Bitcoin\nas payment) has been hampered by its massive energy consumption and\nperceived environmental impact.\n\n`<img src=\"bip-0052/btc_energy-small.png\">`{=html}`</img>`{=html}\n\nFigure. Bitcoin price and estimated Bitcoin energy consumption. Data\nsources: [Cambridge Bitcoin Electricity Consumption\nIndex](https://cbeci.org), [CoinDesk](https://www.coindesk.com).\n\nWe propose a novel proof-of-work paradigm for Bitcoin\\--Optical\nproof-of-work. It is designed to decouple Bitcoin mining from energy and\nmake it feasible outside of regions with low electricity costs. *Optical\nproof-of-work* (oPoW) is a modification of Hashcash that is most\nefficiently computed using a new class of photonic processors. Without\ncompromising the cryptographic or game-theoretical security of Hashcash,\noPoW shifts the operating expenses of mining (OPEX), to capital expenses\n(CAPEX)\\--i.e. electricity to hardware. oPoW makes it possible for\nbillions of new miners to enter the market simply by investing in a\nlow-energy photonic miner. Shifting to a high-CAPEX PoW has the added\nbenefit of making the hashrate resilient to Bitcoin\\'s price\nfluctuations - once low-OPEX hardware is operating there is no reason to\nshut it down even if the value of mining rewards diminishes. oPoW is\nhardware-compatible with GPUs, FPGAs, and ASICs meaning that a\ntransitional period of optical and traditional hardware mining in\nparallel on the network is feasible\n\nMore information is available here: [1](https://www.powx.org/opow)."
    },
    {
      "header": "Abstract",
      "content": "As Bitcoin gained utility and value over the preceding decade, the\nnetwork incentivized the purchase of billions of dollars in mining\nequipment and electricity. With the growth of competition, home mining\nbecame unprofitable. Even the most sophisticated special-purpose\nhardware (ASIC miners) doesn't cover its energy costs unless the miner\nalso has direct access to very cheap electricity. This heavy reliance on\nenergy makes it difficult for new miners to enter the market and leads\nto hashrate instability as miners shut off their machines when the price\nof Bitcoin falls. Additionally as the network stores ever more value,\nthe percentage of world energy consumption that is associated with\nBitcoin continues to grow, creating the potential for scaling failure\nand a general backlash. To ensure that Bitcoin can continue scaling and\nreach its full potential as a world currency and store of value, we\npropose a low-energy proof-of-work paradigm for Bitcoin. *Optical proof\nof work (oPoW)* is designed to decouple Bitcoin's security from massive\nenergy use and make bitcoin mining feasible outside of regions with low\nelectricity costs. *Optical proof-of-work* is a modification of Hashcash\nthat is most efficiently computed using a new class of photonic\nprocessors that has emerged as a leading solution for ultra-low energy\ncomputing over the last 5 years. oPoW shifts the operating expenses of\nmining (OPEX), to capital expenses (CAPEX)--i.e.\u00a0electricity to\nhardware, without compromising the cryptographic or game-theoretical\nsecurity of Hashcash. We provide an example implementation of oPoW,\nbriefly discuss its cryptographic construction as well as the working\nprinciple of photonic processors. Additionally, we outline the potential\nbenefits of oPoW to the bitcoin network, including geographic\ndecentralization and democratization of mining as well as hashrate\nresilience to price fluctuations."
    },
    {
      "header": "Copyright",
      "content": "This BIP is dual-licensed under the Open Publication License and BSD\n2-clause license."
    },
    {
      "header": "Motivation",
      "content": "As Bitcoin has grown over the past decade from a small network run by\nhobbyists to a global currency, the underlying Proof of Work protocol\nhas not been updated. Initially pitched as a global decentralized\nnetwork (\"one CPU-one vote\"), Bitcoin transactions today are secured by\na small group of corporate entities. In practice, it is only feasible\nfor [entities that can secure access to abundant, inexpensive\nenergy](http://archive.is/YeDwh). The economics of mining limit\nprofitability to places like Iceland, Texas, or Western China. Besides\nthe negative environmental externalities, which may be significant,\nmining today is performed primarily with the consent (and in many cases,\npartnership) of large public utilities and the governments that control\nthem. Although this may not be a problem in the short term, in the long\nterm it stands to erode the censorship resistance and security of\nBitcoin and other public blockchains through potential regulation or\n[partitioning attacks](https://arxiv.org/pdf/1605.07524.pdf).\n\nRecent events, such as the [\\~25% hashrate crash due to coal-powered\ngrid failure in\nchina](https://twitter.com/MustafaYilham/status/1384278267067203590) and\nTesla's rescinding of its acceptance of Bitcoin as a form of payment,\nshow that there are practical real-world downsides to Proof of Works's\nmassive reliance on energy.\n\n`<img src=\"bip-0052/emusk_tweet.png\">`{=html}`</img>`{=html}\n\nWhether or not the Bitcoin community accepts this common criticism as\nentirely valid, it has real-world effects which will only get worse over\ntime. Eliminating the exponentially growing energy use currently built\ninto Bitcoin without eliminating the security of PoW would be ideal and\nshould not be a partisan issue.\n\nNew consensus mechanisms have been proposed as a means of securing\ncryptocurrencies whilst reducing energy cost, such as various forms of\nProof of Stake and Proof of Space-Time. While many of these alternative\nmechanisms offer compelling guarantees, they generally require new\nsecurity assumptions, which have not been stress-tested by live\ndeployments at any adequate scale. Consequently, we still have\nrelatively little empirical understanding of their safety. Completely\nchanging the Bitcoin paradigm is likely to introduce new unforeseen\nproblems. We believe that the major issues discussed above can be\nresolved by improving rather than eliminating Bitcoin's fundamental\nsecurity layer---Proof of Work. Instead of devising a new consensus\narchitecture to fix these issues, it is sufficient to shift the\neconomics of PoW. The financial cost imposed on miners need not be\nprimarily composed of electricity. The situation can be significantly\nimproved by reducing the operating expense (OPEX)---energy---as a major\nmining component. Then, by shifting the cost towards capital expense\n(CAPEX)---mining hardware---the dynamics of the mining ecosystem becomes\nmuch less dependent on electricity prices, and much less electricity is\nconsumed as a whole.\n\nMoreover, a reduction in energy consumption automatically leads to\ngeographically distributed mining, as mining becomes profitable even in\nregions with expensive electricity. Additionally, lower energy\nconsumption will eliminate heating issues experienced by today's mining\noperations, which will further decrease operating cost as well as noise\nassociated with fans and cooling systems. All of this means that\nindividuals and smaller entities would be able to enter the mining\necosystem simply for the cost of a miner, without first gaining access\nto cheap energy or a dedicated, temperature-controlled data center. To a\ndegree, memory-hard PoW schemes like [Cuckoo\nCycle](https://github.com/tromp/cuckoo), which increase the use of SRAM\nin lieu of pure computation, push the CAPEX/OPEX ratio in the right\ndirection by occupying ASIC chip area with memory. To maximize the CAPEX\nto OPEX ratio of the Optical Proof of Work algorithm, we developed\n[*HeavyHash*](https://assets.pubpub.org/xi9h9rps/01581688887859.pdf)\n\\[1\\]. HeavyHash is a cryptographic construction that takes the place of\nSHA256 in Hashcash. Our algorithm is hardware-compatible with\nultra-energy-efficient photonic co-processors that have been developed\nfor machine learning hardware accelerators.\n\nHeavyHash uses a proven digital hash (SHA3) packaged with a large amount\nof MAC (Multiply-and-Accumulate) computation into a Proof of Work\npuzzle. Although HeavyHash can be computed on any standard digital\nhardware, it becomes hardware efficient only when a small digital core\nis combined with a low-power photonic co-processor for performing MAC\noperations. oPoW mining machines will have a small digital core\nflip-chipped onto a large, low-power photonic chip. This core will be\nbottlenecked by the throughput of the digital to analog and analog to\ndigital converters. A prototype of such analogue optical matrix\nmultiplier can be seen in the figure below.\n\n`<img src=\"bip-0052/optical_chip.png\">`{=html}`</img>`{=html}\n\nFigure. TOP: Photonic Circuit Diagram, A. Laser input (1550nm, common\ntelecom wavelength) B. Metal pads for controlling modulators to\ntransduce electrical data to optical C. Metal pads for tuning mesh of\ndirectional couplers D. Optical signal exits here containing the results\nof the computation and is output to fibers via a grating coupler the\nterminus of each waveguide. E. Alignment circuit for aligning fiber\ncoupling stage. Bottom: a photograph of a bare oPoW miner prototype chip\nbefore wire and fiber bonding. On the right side of the die are test\nstructures (F).\n\nThe *HeavyHash* derives its name from the fact that it is bloated or\nweighted with additional computation. This means that a cost comparable\noPoW miner will have a much lower nominal hashrate compared to a Bitcoin\nASIC (HeavyHashes/second vs.\u00a0SHA256 Hashes/second in equivalent ASIC).\nWe provide the cryptographic security argument of the HeavyHash function\nin Section 3 in [Towards Optical Proof of\nWork](https://assets.pubpub.org/xi9h9rps/01581688887859.pdf) \\[1\\]. In\nthe article, we also provide a game-theoretic security argument for\nCAPEX-heavy PoW. For additional information, we recommend reading [this\narticle](https://uncommoncore.co/wp-content/uploads/2019/10/A-model-for-Bitcoins-security-and-the-declining-block-subsidy-v1.02.pdf).\n\nWhile traditional digital hardware relies on electrical currents,\noptical computing uses light as the basis for some of or all of its\noperations. Building on the development and commercialization of silicon\nphotonic chips for telecom and datacom applications, modern photonic\nco-processors are silicon chips made using well-established and highly\nscalable silicon CMOS processes. However, unlike cutting edge\nelectronics which require ever-smaller features (e.g.\u00a05 nm), fabricated\nby exponentially more complex and expensive machinery, silicon photonics\nuses old fabrication nodes (90 nm). Due to the large de Broglie\nwavelength of photons, as compared to electrons, there is no benefit to\nusing the small feature sizes. The result is that access to silicon\nphotonic wafer fabrication is readily available, in contrast to the\nnotoriously difficult process of accessing advanced nodes. Moreover, the\noverall cost of entry is lower as lithography masks for silicon\nphotonics processes are an order of magnitude cheaper (\\$500k vs.\u00a0\\$5M).\nExamples of companies developing optical processors for AI, which will\nbe hardware-compatible with oPoW include\n[Lightmatter](https://lightmatter.co/),\n[Lightelligence](https://www.lightelligence.ai/),\n[Luminous](https://luminous.co/),\n[Intel](https://www.intel.com/content/www/us/en/architecture-and-technology/silicon-photonics/silicon-photonics-overview.html),\nand other more recent entrants."
    },
    {
      "header": "Specification",
      "content": "### HeavyHash\n\nThe HeavyHash is performed in three stages:\n\n1.  Keccak hash\n2.  Matrix-vector multiplication\n3.  Keccak of the result xorred with the hashed input\n\nNote that the most efficient matrix-vector multiplication is performed\non a photonic miner. However, this linear algebra operation can be\nperformed on any conventional computing hardware (CPU, GPU, etc.),\ntherefore making the HeavyHash hardware-compatible with any digital\ndevice.\n\nThe algorithm's pseudo-code:\n\n// M is a Matrix 64 x 64 of Unsigned 4 values\n\n// 256-bitVector\nx1 <- keccak(input)\n\n// Reshape the obtained bitvector\n// into a 64-vector of unsigned 4-bit values\nx2 <- reshape(x1, 64)\n\n// Perform a matrix-vector multiplication.\n// The result is 64-vector of 14-bit unsigned. \nx3 <- vector_matrix_mult(x2, M)\n\n// Truncate all values to 4 most significant bits.\n// This is due to the specifics of analog\n// computing by the photonic accelerator.\n// Obtain a 64-vector of 4-bit unsigned.\nx4 <- truncate_to_msb(x3, 4)\n\n// Interpret as a 256-bitvector\nx5 <- flatten(x4)\n\n// 256-bitVector\nresult <- keccak(xor(x5, x1))\n\nWhich in C can be implemented as:\n\nstatic void heavyhash(const uint16_t matrix[64][64], void* pdata, size_t pdata_len, void* output)\n{\nuint8_t hash_first[32] __attribute__((aligned(32)));\nuint8_t hash_second[32] __attribute__((aligned(32)));\nuint8_t hash_xored[32] __attribute__((aligned(32)));\n\nuint16_t vector[64] __attribute__((aligned(64)));\nuint16_t product[64] __attribute__((aligned(64)));\n\nsha3_256((uint8_t*) hash_first, 32, (const uint8_t*)pdata, pdata_len);\n\nfor (int i = 0; i < 32; ++i) {\nvector[2*i] = (hash_first[i] >> 4);\nvector[2*i+1] = hash_first[i] & 0xF;\n}\n\nfor (int i = 0; i < 64; ++i) {\nuint16_t sum = 0;\nfor (int j = 0; j < 64; ++j) {\nsum += matrix[i][j] * vector[j];\n}\nproduct[i] = (sum >> 10);\n}\n\nfor (int i = 0; i < 32; ++i) {\nhash_second[i] = (product[2*i] << 4) | (product[2*i+1]);\n}\n\nfor (int i = 0; i < 32; ++i) {\nhash_xored[i] = hash_first[i] ^ hash_second[i];\n}\nsha3_256((uint8_t*)output, 32, (const uint8_t*)hash_xored, 32);\n}"
    },
    {
      "header": "Random matrix generation {#random_matrix_generation}",
      "content": "The random matrix M (which is a HeavyHash parameter) is obtained in a\ndeterministic way and is changed every block. Matrix M coefficients are\ngenerated using a pseudo-random number generation algorithm (xoshiro)\nfrom the previous block header. If the matrix is not full rank, it is\nrepeatedly generated again.\n\nAn example code to obtain the matrix M:\n\nvoid generate_matrix(uint16_t matrix[64][64], struct xoshiro_state *state) {\ndo {\nfor (int i = 0; i < 64; ++i) {\nfor (int j = 0; j < 64; j += 16) {\nuint64_t value = xoshiro_gen(state);\nfor (int shift = 0; shift < 16; ++shift) {\nmatrix[i][j + shift] = (value >> (4*shift)) & 0xF;\n}\n}\n}\n} while (!is_full_rank(matrix));\n}\n\nstatic inline uint64_t xoshiro_gen(struct xoshiro_state *state) {\nconst uint64_t result = rotl64(state->s[0] + state->s[3], 23) + state->s[0];\n\nconst uint64_t t = state->s[1] << 17;\n\nstate->s[2] ^= state->s[0];\nstate->s[3] ^= state->s[1];\nstate->s[1] ^= state->s[2];\nstate->s[0] ^= state->s[3];\n\nstate->s[2] ^= t;\n\nstate->s[3] = rotl64(state->s[3], 45);\n\nreturn result;\n}"
    },
    {
      "header": "Discussion",
      "content": "### Geographic Distribution of Mining Relative to CAPEX-OPEX Ratio of Mining Costs {#geographic_distribution_of_mining_relative_to_capex_opex_ratio_of_mining_costs}\n\nBelow is a simple model showing several scenarios for the geographic\ndistribution of mining activity relative to the CAPEX/OPEX ratio of the\ncost of operating a single piece of mining hardware. As the ratio of\nenergy consumption to hardware cost decreases, geographic variations in\nenergy cost cease to be a determining factor in miner distribution.\n\nUnderlying assumptions: 1. Electricity price y is fixed in time but\nvaries geographically. 2. Every miner has access to the same hardware.\n3. Each miner's budget is limited by both the cost of mining equipment\nas well as the local cost of the electricity they consume\n\nbudget = a(p+ey),\n\nwhere a is the number of mining machines, p is the machine price, e is\nthe total energy consumption over machine lifetime, and y is electricity\nprice.\n\nNote that in locations where mining is not profitable, hashrate is zero.\n\n`<img src=\"bip-0052/sim1.png\">`{=html}`</img>`{=html}\n\n`<img src=\"bip-0052/sim2.png\">`{=html}`</img>`{=html}\n\n`<img src=\"bip-0052/sim3.png\">`{=html}`</img>`{=html}\n\nAn interactive version of this diagram can be found\n[here](https://www.powx.org/opow)."
    },
    {
      "header": "Why does CAPEX to OPEX shift lead to lower energy consumption? {#why_does_capex_to_opex_shift_lead_to_lower_energy_consumption}",
      "content": "A common misconception about oPoW is that it makes mining \"cheaper\" by\nenabling energy-efficient hardware. There is no impact on the dollar\ncost of mining a block, rather the mix of energy vs.\u00a0hardware investment\nchanges from about 50/50 to 10/90 or better. We discuss this at length\nand rigorously in our paper\\[1\\]."
    },
    {
      "header": "Working Principles of Photonic Processors {#working_principles_of_photonic_processors}",
      "content": "Photonics accelerators are made by fabricating waveguides in silicon\nusing standard lithography processes. Silicon is transparent to infrared\nlight and can act as a tiny on-chip fiber optical cable. Silicon\nphotonics found its first use during the 2000s in transceivers for\nsending and receiving optical signals via fiber and has advanced\ntremendously over the last decade.\n\nBy encoding a vector into optical intensities passing through a series\nof parallel waveguides, interfering these signals in a mesh of tunable\ninterferometers (acting as matrix coefficients), and then detecting the\noutput using on-chip Germanium photodetectors, a matrix-vector\nmultiplication is achieved. A generalized discussion of matrix\nmultiplication setups using photonics/interference can be found in [Reck\net al.](https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.73.58)\nand [Russell et al.](https://arxiv.org/abs/1506.06220) A detailed\ndiscussion of several integrated photonic architectures for matrix\nmultiplication and corresponding tuning algorithms can be found in [Pai\net al.](https://arxiv.org/pdf/1909.06179.pdf)\n\nBelow is a conceptual representation of a 3D-packaged oPoW mining chip.\nNote that the majority of the real estate and cost comes from the\nphotonic die and the laser, with only a small digital SHA3 die needed\n(as opposed to a conventional miner of the same cost, which would have\nmany copies of this die running in parallel).\n\n`<img src=\"bip-0052/optminer.png\">`{=html}`</img>`{=html}"
    },
    {
      "header": "Block Reward Considerations {#block_reward_considerations}",
      "content": "Although it is out of the scope of this proposal, the authors strongly\nrecommend the consideration of a change in the block reward schedule\ncurrently implemented in Bitcoin. There is no clear way to incentivize\nminers with transaction fees only, as has been successfully shown in [On\nthe Instability of Bitcoin Without the Block\nReward](https://www.cs.princeton.edu/~smattw/CKWN-CCS16.pdf) and other\npublications, therefore looking a decade or two ahead it will be\nimportant to implement a fixed block reward or to slow the decay of the\nblock reward to maintain the security of the network. Given that oPoW\nminers have low operating costs, once a large number of machines are\nrunning the reward level sufficient to keep them in operation and\nproviding robust security can potentially be significantly smaller than\nin the case of the current SHA256 ASICs securing Bitcoin."
    },
    {
      "header": "Implementation on the Bitcoin Network {#implementation_on_the_bitcoin_network}",
      "content": "A hard fork is not necessarily required for the Bitcoin network to test\nand eventually implement oPoW. It's possible to add oPoW as a dual PoW\nto Bitcoin as a soft fork. Tuning the parameters to ensure that, for\nexample, 99.9% of the security budget would be earned by miners via the\nSHA256 Hashcash PoW and 0.1% via oPoW would create sufficient incentive\nfor oPoW to be stress-tested and to incentivize the manufacture of\ndedicated oPoW miners. If this test is successful, the parameters can be\ntuned continuously over time, e.g.\u00a0oPoW share doubling at every halving,\nsuch that oPoW accounts for some target percentage (up to 100% in a\ncomplete SHA256 phase-out)."
    },
    {
      "header": "Reverse compatibility {#reverse_compatibility}",
      "content": "Our understanding is that oPoW will not be reverse compatible."
    },
    {
      "header": "ASICBOOST",
      "content": "Any new PoW algorithm carries the risk of hardware developers\ndiscovering and patenting an architecture with a significant speedup, as\nhappened in the case of ASICBOOST for SHA256. HeavyHash is comprised of\nan SHA hash and 4-bit linear matrix-vector operations. The intent is for\nthe matrix-vector multiplications to account for the majority of the\nwork involved in computing a single HeavyHash operation. As we show in\nthe Minimum Effective Hardness section of Towards Optical Proof of\nWork\\[1\\], there is no workaround to performing the matrix operations\nwhen computing HeavyHash, and since the SHA hashes are negligible, a\ntrue ASICBOOST-type speed up would require a speed up in linear matrix\nprocessing. Since matrix-vector multiplication is at the heart of neural\nnetworks and many other common computational workloads, it has been\noptimized very heavily and is generally very well understood. The\nacceleration of matrix-vector multiplication hardware (e.g. photonic\ncoprocessors, memristors, etc.) is a very general problem and there are\ndozens of companies working on it, making it very unlikely for a single\nparty to corner the market."
    },
    {
      "header": "Endnotes",
      "content": "With significant progress in optical and analog\nmatrix-vector-multiplication chipsets over the last year, we hope to\ndemonstrate commercial low-energy mining on our network in the next 6\nmonths. The current generation of optical matrix processors under\ndevelopment is expected to have 10x better energy consumption per MAC\noperation than digital implementations, and we expect this to improve by\nanother order of magnitude in future generations.\n\nPoWx will also be publishing the designs of the current optical miner\nprototypes in the near term under an open-source hardware license."
    },
    {
      "header": "Acknowledgments",
      "content": "We thank all the members of the Bitcoin community who have already given\nus feedback over the last several years as well as others in the optical\ncomputing community and beyond that have given their input.\n\n\\[1\\] M. Dubrovsky et al.\u00a0Towards Optical Proof of Work, CES conference\n(2020) <https://assets.pubpub.org/xi9h9rps/01581688887859.pdf>\n\n\\[2\\]\n<https://sciencex.com/news/2020-05-powering-bitcoin-silicon-photonics-power.html>\n\n\\[3\\] KISS random number generator\n<http://www.cse.yorku.ca/~oz/marsaglia-rng.html>"
    }
  ]
}