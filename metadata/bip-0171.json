{
  "BIP": "171",
  "Layer": "Applications",
  "Title": "Currency/exchange rate information API",
  "Author": "Luke Dashjr <luke+bip@dashjr.org>",
  "Comments-Summary": "No comments yet.",
  "Comments-URI": "https://github.com/bitcoin/bips/wiki/Comments:BIP-0171",
  "Status": "Rejected",
  "Type": "Standards Track",
  "Created": "2017-03-04",
  "License": "BSD-2-Clause",
  "sections": [
    {
      "header": "Abstract",
      "content": "A common interface for requesting currency exchange rate information\nfrom a server."
    },
    {
      "header": "Copyright",
      "content": "This BIP is licensed under the BSD 2-clause license."
    },
    {
      "header": "Specification",
      "content": "Four requests are defined, which are all made by a GET request to a\ncommon URI with parameters encoded in application/x-www-form-urlencoded\nformat. All matching parameters may be specified with multiple\ncomma-separated values, which are to be interpreted as \\\"any of these\\\".\nEach result is always in JSON format, with a line-feed (never a\ncarriage-return) separating multiple results.\n\nAuthentication for subscription-based services MAY be supported using\nstandard HTTP authentication. It is recommended to use TLS (HTTPS)\nand/or Linked Data Signatures, so that MITM attackers cannot deceive the\nclient.\n\nTo be BIP 171 compatible, servers MUST support at least one\ncurrency-pair compared to XBT. All inquiries for bitcoin amounts MUST be\nspecified in XBT, even if the presentation to the end user is in another\nunit. (FIXME: or should this be satoshis?)\n\nCurrency-pair tokens are arbitrary Strings no longer than 255\ncharacters, which may include any ASCII [RFC 3986 unreserved\ncharacters](https://tools.ietf.org/html/rfc3986#section-2.3) (ie,\nalphanumerics and the hyphen, underscore, period, and tilde symbols).\n\nCurrency code(s) used herein are defined as such:\n\n-   All ISO 4217 codes are valid currency codes.\n-   XBT is defined as 100000000 satoshis (commonly known as 1 BTC).\n-   Strings longer than 3 characters may be used for currencies without\nan applicable code. (If a shorter code is desired despite this, it\nmay be padded with space(s) to the left until it is 4 characters.\nSoftware MAY strip these spaces.)\n\nRate is defined as the amount of quote-currency to be exchanged for one\nunit of the base-currency. In other words,\n`1 baseCurrency = rate quoteCurrency`."
    },
    {
      "header": "Enumerating supported currency-pair tokens {#enumerating_supported_currency_pair_tokens}",
      "content": "Parameters:\n\n-   *mode* - Always \\\"list\\\" for this request.\n-   *quote* - If provided, the server MAY limit the results to only\ncurrency-pairs describing a currency with the given currency\ncode(s).\n-   *base* - If provided, the server MAY limit the results to only\ncurrency-pairs describing currency rates compared to the given\ncurrency code(s).\n-   *locale* - If provided, the server MAY limit the results to only\ncurrency-pairs supporting the given Unicode CLDR locale(s).\n\nEach currency-pair will receive a separate result, a JSON Object, with\nthe following information:\n\n-   *cp* - The currency-pair token.\n-   *quote* - The currency code for the quote currency.\n-   *base* - The currency code for the base currency.\n-   *locale* - If provided, a String with the applicable Unicode CLDR\nlocale.\n-   *desc* - Optional description. For example, it could be \\\"Based on\nFlorida BTM prices.\\\" or any other short String that provides\ninformation useful to the user. SHOULD be shorter than 45\ncharacters.\n-   *signature* - Optional. May be used for Linked Data Signatures.\n\nExample:\n\n`\u00a0\u00a0\u00a0Request:\u00a0`[`http://api.example.tld/?mode=list&quote=USD&base=XBT&locale=en_US,en_GB`](http://api.example.tld/?mode=list&quote=USD&base=XBT&locale=en_US,en_GB)\\\n`\u00a0\u00a0\u00a0Result:`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"quote\":\"USD\",\u00a0\"base\":\u00a0\"XBT\",\u00a0\"locale\":\u00a0\"en_US\",\u00a0\"desc\":\u00a0\"Smoothed\u00a0averages\"}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"quote\":\"USD\",\u00a0\"base\":\u00a0\"XBT\",\u00a0\"locale\":\u00a0\"en_US\",\u00a0\"desc\":\u00a0\"Updated\u00a0per-trade\"}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-european\",\u00a0\"quote\":\"USD\",\u00a0\"base\":\u00a0\"XBT\",\u00a0\"locale\":\u00a0\"en_GB\"}`"
    },
    {
      "header": "Currency-pair information {#currency_pair_information}",
      "content": "Parameters:\n\n-   *mode* - Always \\\"info\\\" for this request.\n-   *cp* - Currency pair(s) for which information is requested.\n\nEach currency-pair will receive a separate result, a JSON Object, with\nthe following information:\n\n-   *cp* - The currency-pair token.\n-   *quote* - The currency code for the quote currency.\n-   *base* - The currency code for the base currency.\n-   *locale* - If provided, a String with the applicable Unicode CLDR\nlocale.\n-   *desc* - Optional description. For example, it could be \\\"Based on\nFlorida BTM prices.\\\" or any other short String that provides\ninformation useful to the user. SHOULD be shorter than 45\ncharacters.\n-   *longdesc* - Optional description, but may be longer and include\nnewlines.\n-   *symbol* - An Array of prefix and suffix for the quote currency.\nEach may be either a fixed String, an Array of two Strings (negative\nand positive), or null. Any positive or negative symbols must be\nincluded in this prefix/suffix; it MUST NOT be implied otherwise.\n-   *digits* - The type of digits to use for the quote currency\\'s\nnumbers. \\\"arabic\\\" should be used for common 0-9 digits.\n-   *grouping* - An Array alternating between Numbers representing a\nseries of digits, and Strings used as delimiters. If terminated by a\nzero, the final grouping is to be repeated continually. For example,\nthe common US locale thousands grouping would be `[3, \",\", 0]`\n-   *fraction_sep* - A String to be placed between whole numbers and a\nfractional amount.\n-   *fraction_digits* - Array of absolute minimum (even for whole\nnumbers) number of fractional digits, minimum fractional digits when\na fraction exists, and maximum number of fractional digits when\nabsolute precision is not demanded (below which is to be rounded in\nan implementation-dependent manner).\n-   *minpoll* - A Number of seconds indicating a minimum time between\npolls to the server. Clients should be prudent about not polling too\noften, even if this number is low.\n-   *longpoll* - If provided and true, indicates longpolling is\nsupported by the server.\n-   *history* - If provided, indicates the server has historical records\ngoing back no earlier than the POSIX timestamp provided as a value.\n-   *archive* - If provided, indicates the server no longer has current\nrates, and has no historical rates more recent than the POSIX\ntimestamp provided as a value.\n-   *signature* - Optional. May be used for Linked Data Signatures.\n\nExample:\n\n`\u00a0\u00a0\u00a0Request:\u00a0`[`http://api.example.tld/?mode=info&cp=XBTUSD-ver4,2`](http://api.example.tld/?mode=info&cp=XBTUSD-ver4,2)\\\n`\u00a0\u00a0\u00a0Result:`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"quote\":\"USD\",\u00a0\"base\":\u00a0\"XBT\",\u00a0\"locale\":\u00a0\"en_US\",\u00a0\"desc\":\u00a0\"Smoothed\u00a0averages\",\u00a0\"longdesc\":\u00a0\"USD\u00a0price\u00a0quotes\u00a0as\u00a0compared\u00a0to\u00a0Bitcoin\u00a0value\\n\\nRecommended\u00a0for\u00a0casual\u00a0usage\",\u00a0\"symbol\":\u00a0[[\"-$\",\u00a0\"$\"],\u00a0null],\u00a0\"digits\":\u00a0\"arabic\",\u00a0\"grouping\":\u00a0[3,\u00a0\",\",\u00a00],\u00a0\"fraction_sep\":\u00a0\".\",\u00a0\"fraction_digits\":\u00a0[0,\u00a02,\u00a02],\u00a0\"minpoll\":\u00a0300,\u00a0\"longpoll\":\u00a0true,\u00a0\"history\":\u00a01457231416}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"quote\":\"USD\",\u00a0\"base\":\u00a0\"XBT\",\u00a0\"locale\":\u00a0\"en_US\",\u00a0\"desc\":\u00a0\"Updated\u00a0per-trade\",\u00a0\"longdesc\":\u00a0\"Maximum\u00a0precision\u00a0USD\u00a0price\u00a0quotes\u00a0as\u00a0compared\u00a0to\u00a0Bitcoin\u00a0value\",\u00a0\"symbol\":\u00a0[[\"-$\",\u00a0\"$\"],\u00a0null],\u00a0\"digits\":\u00a0\"arabic\",\u00a0\"grouping\":\u00a0[3,\u00a0\",\",\u00a00],\u00a0\"fraction_sep\":\u00a0\".\",\u00a0\"fraction_digits\":\u00a0[0,\u00a02,\u00a02],\u00a0\"minpoll\":\u00a03600,\u00a0\"longpoll\":\u00a0false,\u00a0\"history\":\u00a01467458333.1225}`"
    },
    {
      "header": "Current exchange rate {#current_exchange_rate}",
      "content": "Parameters:\n\n-   *mode* - Always \\\"rate\\\" for this request.\n-   *cp* - Currency pair(s) for which rate is requested.\n-   *type* - Type of exchange rate data being requested. May be\n\\\"high\\\", \\\"low\\\", \\\"average\\\", \\\"typical\\\", or any other arbitrary\nname. If omitted, the server may provide any rates it deems\nappropriate.\n-   *minrate*, *maxrate* - If specified, indicates this request is a\nlongpoll. The server should not send a response until the rate(s)\nfall below or above (respectively) the provided value.\n-   *nonce* - If specified, the server SHOULD return it in each result.\n\nEach currency-pair receives a separate result (a JSON Object) with all\nrequested rate types:\n\n-   *cp* - The currency-pair token.\n-   *time* - The time (as a POSIX timestamp) the rate information is\napplicable to (should be approximately the request time).\n-   *rates* - A JSON Object with each rate type provided as a key, and a\nNumber as the value specifying the rate.\n-   *nonce* - Only if the request specified a nonce, the server SHOULD\ninclude it here as a JSON String.\n-   *signature* - Optional. May be used for Linked Data Signatures.\n\nExample:\n\n`\u00a0\u00a0\u00a0Request:\u00a0`[`http://api.example.tld/?mode=rate&cp=XBTUSD-ver4,2&type=typical,high`](http://api.example.tld/?mode=rate&cp=XBTUSD-ver4,2&type=typical,high)\\\n`\u00a0\u00a0\u00a0Result:`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488767410.5463133,\u00a0\"rates\":\u00a0{\"typical\":\u00a01349.332215,\u00a0\"high\":\u00a01351.2}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488767410,\u00a0\"rates\":\u00a0{\"typical\":\u00a01350.111332}}`"
    },
    {
      "header": "Historical exchange rates {#historical_exchange_rates}",
      "content": "Parameters:\n\n-   *mode* - Always \\\"history\\\" for this request.\n-   *cp* - Currency pair(s) for which rate is requested.\n-   *type* - Type of exchange rate data being requested. May be\n\\\"high\\\", \\\"low\\\", \\\"average\\\", \\\"typical\\\", or any other arbitrary\nname. If omitted, the server may provide any rates it deems\nappropriate.\n-   *from* - POSIX timestamp the results should begin with.\n-   *to* - POSIX timestamp the results should end with. If omitted, the\npresent time shall be used.\n-   *nearest* - If provided and true, indicates that only the nearest\ntimestamp to \\\"from\\\" must be returned, and a range is not desired.\n(\\\"to\\\" should be omitted in this case.)\n-   *ratedelta*, *timedelta* - If specified, the server may omit data\nwhere the rate or time has not changed since the last provided rate\nand time. If both are provided, either a significant rate change OR\ntime change should trigger a new record in the results.\n\nA result is provided for each currency-pair and timestamp record, in the\nsame format as the current exchange rate request. Records MUST be\nprovided in chronological order, but only within the scope of the\napplicable currency-pair (ie, it is okay to send the full history for\none currency-pair, and then the full history for the next; or to\nintermix them out of any given order).\n\nIf there is no exact record for the times specified by \\\"from\\\" and/or\n\\\"to\\\", a single record before \\\"from\\\" and/or after \\\"to\\\" should also\nbe included. This is not necessary when only the nearest record is\nrequested, or when \\\"to\\\" is omitted (ie, ending at the most recent\nrecord).\n\nExample:\n\n`\u00a0\u00a0\u00a0Request:\u00a0`[`http://api.example.tld/?mode=history&cp=XBTUSD-ver4,2&type=typical&ratedelta=0.1&timedelta=10&from=1488759998&to=1488760090`](http://api.example.tld/?mode=history&cp=XBTUSD-ver4,2&type=typical&ratedelta=0.1&timedelta=10&from=1488759998&to=1488760090)\\\n`\u00a0\u00a0\u00a0Result:`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488760000,\u00a0\"rates\":\u00a0{\"typical\":\u00a01300}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488760010,\u00a0\"rates\":\u00a0{\"typical\":\u00a01301.1}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488760020,\u00a0\"rates\":\u00a0{\"typical\":\u00a01320}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488760030,\u00a0\"rates\":\u00a0{\"typical\":\u00a01305}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488760000.1,\u00a0\"rates\":\u00a0{\"typical\":\u00a01300}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488760010.2,\u00a0\"rates\":\u00a0{\"typical\":\u00a01301.1}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488760020.2,\u00a0\"rates\":\u00a0{\"typical\":\u00a01320.111332}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488760031,\u00a0\"rates\":\u00a0{\"typical\":\u00a01305.222311}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488760040,\u00a0\"rates\":\u00a0{\"typical\":\u00a01303.33}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488760042,\u00a0\"rates\":\u00a0{\"typical\":\u00a01303.33}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488760050,\u00a0\"rates\":\u00a0{\"typical\":\u00a01305}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488760052,\u00a0\"rates\":\u00a0{\"typical\":\u00a01307}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488760060,\u00a0\"rates\":\u00a0{\"typical\":\u00a01309}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488760072,\u00a0\"rates\":\u00a0{\"typical\":\u00a01308}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488760062,\u00a0\"rates\":\u00a0{\"typical\":\u00a01309.55555555}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488760072,\u00a0\"rates\":\u00a0{\"typical\":\u00a01308}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"XBTUSD-ver4\",\u00a0\"time\":\u00a01488760082,\u00a0\"rates\":\u00a0{\"typical\":\u00a01309}}`\\\n`\u00a0\u00a0\u00a0\u00a0\u00a0{\"cp\":\"2\",\u00a0\"time\":\u00a01488760082,\u00a0\"rates\":\u00a0{\"typical\":\u00a01309.1}}`"
    },
    {
      "header": "Motivation",
      "content": "End users often desire to see fiat currency information in their Bitcoin\nwallet software. Due to the nature of Bitcoin, there is inherently no\nauthoritative source for exchange rates. There are many independent\nproviders of such information, but they all use different formats for\nproviding it, so wallet software is currently forced to implement\ndedicated code for each provider.\n\nBy providing a standard interface for retrieving this information,\nwallets (and other software) and service providers can implement it\nonce, and become immediately interoperable with all other compatible\nimplementations."
    },
    {
      "header": "Rationale",
      "content": "Why are multiple results separated by a line-feed rather than using a\nJSON Array?\n\n-   Clients ought to cache historical data, and using a line-feed format\nallows them to simply append to a cache file.\n-   Parsing JSON typically requires the entire data parsed together as a\nsingle memory object. Using simple lines to separate results,\nhowever, allows parsing a single result at a time.\n\nWhat if long descriptions require line and paragraph breaks?\n\n-   Clients should word-wrap long lines, and JSON escapes newlines as\n\\\"\\\\n\\\" which can be used doubly (\\\"\\\\n\\\\n\\\") for paragraph breaks."
    },
    {
      "header": "Backwards compatibility {#backwards_compatibility}",
      "content": "While this new standard is adopted, software and providers can continue\nto use and provide their current formats until they are no longer\nneeded."
    },
    {
      "header": "Reference implementation {#reference_implementation}",
      "content": "TODO"
    },
    {
      "header": "See also {#see_also}",
      "content": "-   [Draft W3c Linked Data Signatures\nspecification](https://w3c-dvcg.github.io/ld-signatures/)"
    }
  ]
}