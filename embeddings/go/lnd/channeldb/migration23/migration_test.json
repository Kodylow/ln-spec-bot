{
  "filepath": "../implementations/go/lnd/channeldb/migration23/migration_test.go",
  "package": "migration23",
  "sections": [
    {
      "slug": "func TestMigrateHtlcAttempts(t *testing.T) {",
      "content": "func TestMigrateHtlcAttempts(t *testing.T) {\n\tvar paymentsRootBucket = []byte(\"payments-root-bucket\")\n\ttests := []struct {\n\t\tname       string\n\t\tshouldFail bool\n\t\tpre        map[string]interface{}\n\t\tpost       map[string]interface{}\n\t}{\n\t\t{\n\t\t\tname:       \"migration ok\",\n\t\t\tshouldFail: false,\n\t\t\tpre:        pre,\n\t\t\tpost:       post,\n\t\t},\n\t\t{\n\t\t\tname:       \"non-bucket payments-root-bucket\",\n\t\t\tshouldFail: true,\n\t\t\tpre:        failing1,\n\t\t\tpost:       failing1,\n\t\t},\n\t\t{\n\t\t\tname:       \"non-bucket payment-htlcs-bucket\",\n\t\t\tshouldFail: true,\n\t\t\tpre:        failing2,\n\t\t\tpost:       failing2,\n\t\t},\n\t\t{\n\t\t\tname:       \"non-bucket htlc attempt\",\n\t\t\tshouldFail: true,\n\t\t\tpre:        failing3,\n\t\t\tpost:       failing3,\n\t\t},\n\t}\n\n\tfor _, test := range tests {\n\t\ttest := test\n\n\t\tmigtest.ApplyMigration(\n\t\t\tt,\n\t\t\tfunc(tx kvdb.RwTx) error {\n\t\t\t\treturn migtest.RestoreDB(\n\t\t\t\t\ttx, paymentsRootBucket, test.pre,\n\t\t\t\t)\n\t\t\t},\n\t\t\tfunc(tx kvdb.RwTx) error {\n\t\t\t\treturn migtest.VerifyDB(\n\t\t\t\t\ttx, paymentsRootBucket, test.post,\n\t\t\t\t)\n\t\t\t},\n\t\t\tMigrateHtlcAttempts,\n\t\t\ttest.shouldFail,\n\t\t)\n\t}\n}\n",
      "length": 981,
      "tokens": 102,
      "embedding": []
    }
  ]
}