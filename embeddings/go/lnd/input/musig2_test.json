{
  "filepath": "../implementations/go/lnd/input/musig2_test.go",
  "package": "input",
  "sections": [
    {
      "slug": "func TestMuSig2CombineKeys(t *testing.T) {",
      "content": "func TestMuSig2CombineKeys(t *testing.T) {\n\tt.Parallel()\n\n\ttestCases := []struct {\n\t\tname                string\n\t\tversion             MuSig2Version\n\t\tkeys                []*btcec.PublicKey\n\t\tsortKeys            bool\n\t\ttweak               *MuSig2Tweaks\n\t\texpectedErr         string\n\t\texpectedFinalKey    string\n\t\texpectedPreTweakKey string\n\t}{{\n\t\tname:        \"invalid version\",\n\t\tversion:     7,\n\t\texpectedErr: \"unknown MuSig2 version: <7>\",\n\t}, {\n\t\tname:     \"v0.4.0 two dummy keys BIP86\",\n\t\tversion:  MuSig2Version040,\n\t\tkeys:     []*btcec.PublicKey{dummyPubKey1, dummyPubKey2},\n\t\tsortKeys: true, tweak: bip86Tweak,\n\t\texpectedFinalKey: \"03b54fb320a8fc3589e86a1559c6aaa774fbab4e4d\" +\n\t\t\t\"9fbf31e2fd836b661ac6a132\",\n\t\texpectedPreTweakKey: \"0279c76a15dcf6786058a571e4022b78633e1bf\" +\n\t\t\t\"8a7a4ca440bcbbeeaea772228a2\",\n\t}, {\n\t\tname:    \"v0.4.0 three dummy keys BIP86\",\n\t\tversion: MuSig2Version040,\n\t\tkeys: []*btcec.PublicKey{\n\t\t\tdummyPubKey1, dummyPubKey2, dummyPubKey3,\n\t\t},\n\t\tsortKeys: true,\n\t\ttweak:    bip86Tweak,\n\t\texpectedFinalKey: \"03fa8195d584b195476f20e2fe978fd7312f4b08f2\" +\n\t\t\t\"777f080bcdfc9350603cd6e7\",\n\t\texpectedPreTweakKey: \"03e615b8aad4ed10544537bc48b1d6600e15773\" +\n\t\t\t\"476a675c6cbba6808f21b1988e5\",\n\t}, {\n\t\tname:    \"v0.4.0 three test vector keys BIP86\",\n\t\tversion: MuSig2Version040,\n\t\tkeys: []*btcec.PublicKey{\n\t\t\ttestVector040Key1, testVector040Key2, testVector040Key3,\n\t\t},\n\t\ttweak:    bip86Tweak,\n\t\tsortKeys: true,\n\t\texpectedFinalKey: \"025b257b4e785d61157ef5303051f45184bd5cb47b\" +\n\t\t\t\"c4b4069ed4dd4536459cb83b\",\n\t\texpectedPreTweakKey: \"02d70cd69a2647f7390973df48cbfa2ccc407b8\" +\n\t\t\t\"b2d60b08c5f1641185c7998a290\",\n\t}, {\n\t\tname: \"v0.4.0 three test vector keys BIP86 reverse order\",\n\t\tkeys: []*btcec.PublicKey{\n\t\t\ttestVector040Key3, testVector040Key2, testVector040Key1,\n\t\t},\n\t\tsortKeys: true,\n\t\ttweak:    bip86Tweak,\n\t\texpectedFinalKey: \"025b257b4e785d61157ef5303051f45184bd5cb47b\" +\n\t\t\t\"c4b4069ed4dd4536459cb83b\",\n\t\texpectedPreTweakKey: \"02d70cd69a2647f7390973df48cbfa2ccc407b8\" +\n\t\t\t\"b2d60b08c5f1641185c7998a290\",\n\t}, {\n\t\tname: \"v0.4.0 three test vector keys BIP86 no sort\",\n\t\tkeys: []*btcec.PublicKey{\n\t\t\ttestVector040Key1, testVector040Key2, testVector040Key3,\n\t\t},\n\t\tsortKeys: false,\n\t\ttweak:    bip86Tweak,\n\t\texpectedFinalKey: \"0223e0c640e96000e8e92699ec3802e5c39edf47db\" +\n\t\t\t\"dfdb788b3735b76a55538179\",\n\t\texpectedPreTweakKey: \"03e5830140512195d74c8307e39637cbe5fb730\" +\n\t\t\t\"ebeab80ec514cf88a877ceeee0b\",\n\t}, {\n\t\tname:    \"v1.0.0rc2 three dummy keys BIP86\",\n\t\tversion: MuSig2Version100RC2,\n\t\tkeys: []*btcec.PublicKey{\n\t\t\tdummyPubKey1, dummyPubKey2, dummyPubKey3,\n\t\t},\n\t\tsortKeys: true,\n\t\ttweak:    bip86Tweak,\n\t\texpectedFinalKey: \"029d11a433e446276c88ee099cecfda1e4234dc486\" +\n\t\t\t\"49e2b07f9b159176731eb68a\",\n\t\texpectedPreTweakKey: \"03f0bacfef76086c519b6db216a252f1435336f\" +\n\t\t\t\"d23fc86cfb51f67056439c256d4\",\n\t}, {\n\t\tname:    \"v1.0.0rc2 three test vector keys BIP86\",\n\t\tversion: MuSig2Version100RC2,\n\t\tkeys: []*btcec.PublicKey{\n\t\t\ttestVector100Key1, testVector100Key2, testVector100Key3,\n\t\t},\n\t\tsortKeys: false,\n\t\ttweak:    bip86Tweak,\n\t\texpectedFinalKey: \"03f79d14149ecd4bb74921865906a8e4f1333439a9\" +\n\t\t\t\"1b96610d72caa7495dcf2376\",\n\t\texpectedPreTweakKey: \"0290539eede565f5d054f32cc0c220126889ed1\" +\n\t\t\t\"e5d193baf15aef344fe59d4610c\",\n\t}, {\n\t\tname:    \"v1.0.0rc2 three test vector keys BIP86 sorted\",\n\t\tversion: MuSig2Version100RC2,\n\t\tkeys: []*btcec.PublicKey{\n\t\t\ttestVector100Key1, testVector100Key2, testVector100Key3,\n\t\t},\n\t\tsortKeys: true,\n\t\ttweak:    bip86Tweak,\n\t\texpectedFinalKey: \"0379e6c3e628c9bfbce91de6b7fb28e2aec7713d37\" +\n\t\t\t\"7cf260ab599dcbc40e542312\",\n\t\texpectedPreTweakKey: \"03789d937bade6673538f3e28d8368dda4d0512\" +\n\t\t\t\"f94da44cf477a505716d26a1575\",\n\t}, {\n\t\tname:    \"v1.0.0rc2 three test vector keys BIP86 reverse order\",\n\t\tversion: MuSig2Version100RC2,\n\t\tkeys: []*btcec.PublicKey{\n\t\t\ttestVector100Key3, testVector100Key2, testVector100Key1,\n\t\t},\n\t\tsortKeys: false,\n\t\ttweak:    bip86Tweak,\n\t\texpectedFinalKey: \"03d61d333ab8c53c330290c144f406ce0c0dc3564b\" +\n\t\t\t\"8e3dee6d1daa6288609bfc75\",\n\t\texpectedPreTweakKey: \"036204de8b083426dc6eaf9502d27024d53fc82\" +\n\t\t\t\"6bf7d2012148a0575435df54b2b\",\n\t}}\n\n\tfor _, tc := range testCases {\n\t\ttc := tc\n\t\tt.Run(tc.name, func(tt *testing.T) {\n\t\t\ttt.Parallel()\n\n\t\t\tres, err := MuSig2CombineKeys(\n\t\t\t\ttc.version, tc.keys, tc.sortKeys, tc.tweak,\n\t\t\t)\n\n\t\t\tif tc.expectedErr != \"\" {\n\t\t\t\trequire.ErrorContains(tt, err, tc.expectedErr)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\trequire.NoError(tt, err)\n\n\t\t\tfinalKey := res.FinalKey.SerializeCompressed()\n\t\t\tpreTweakKey := res.PreTweakedKey.SerializeCompressed()\n\t\t\trequire.Equal(\n\t\t\t\ttt, tc.expectedFinalKey,\n\t\t\t\thex.EncodeToString(finalKey),\n\t\t\t)\n\t\t\trequire.Equal(\n\t\t\t\ttt, tc.expectedPreTweakKey,\n\t\t\t\thex.EncodeToString(preTweakKey),\n\t\t\t)\n\t\t})\n\t}\n}\n",
      "length": 4556,
      "tokens": 346,
      "embedding": []
    }
  ]
}